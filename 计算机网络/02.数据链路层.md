# 数据链路层
## 1.数据链路层要实现3个功能
封装成帧、透明传输、差错检验、数据可靠性、流量控制<br>

### 1.封装成帧
数据链路层在物理层和网络层之间，而物理层是传输二进制流的，所以数据链路层必须能够将二进制流解析出帧，并将帧转换成二进制流以方便在物理层传输。<br>
有很多种方法可以用来定界帧。最寻常的方式是设置帧的定界符如：<br>

帧(例如：HDLC)有开始符(SOH)结束符(EOT)，如果在数据中有开始符和结束符，数据数据链路层就会加入转移字符(ESC)<br>

**但是定界符的方法在链路是100Mbps时，就不在试用了**，因为它不能告诉物理链路是否断开或者没有数据传输(在这两种情况下链路都没有信号)。

### 2.差错检验
最常用的两种错误检验机制：校验和与循环冗余校验(CRC)<br>
CRC容易使用硬件实现，且数学证明强壮型高，所以在链路层一般使用CRC。<br>
在高层协议(如TCP、UDP和IP)中使用校验和。<br>

#### 1.校验和
校验和非常简单就是对帧内的二进制做二元加法和，将结果保存下来即可(1位)。<br>

#### 2.循环冗余校验(CRC)
CRC增加了发送数据的长度，在接收端通过做一种除法，如果结果为非0，则数据帧发生了变化。<br>
已证明CRC可以检查的错误：<br>
- 单位错误
- 双位错误
- 任何长度小于FCS的突发错误。<br>

### 3.数据可靠性
当接受到一个错误的数据帧接收机如何回应？
- 1.默默地丢掉不正确的帧
- 2.向发送方返回错误码
- 3.添加纠错码

对于第三种情况纠错码(使用纠错码要添加更多的纠错位)，在一般通信系统中不常用，因为在以太网中数据帧的错误率很低大概``1/10^10``。即是是在无线通信中，也不会添加纠错码。一般在太空通信中，因为重传的成本很高，一般使用纠错码。<br>

发送机会重新发错误的帧，或者是忽略错误。在后一种情况下高层协议，如TCP，将负责重传。<br>

### 4.流量控制
在链路层，流量控制用以解决两点接受和发送速率不对等的情况。<br>
解决该问题的最简单方法是停止等待协议，但它使得链路使用效率很低，所以不过多考虑。<br>

一种常用的方法是滑动窗口协议：<br>



## 2.数据链路层协议
对于数据链路层，通过介绍两个协议来了解。<br>
一个是路由直接通过PPP协议实现传输，还有一个是局域网中的CSMA/CD协议<br>
## 4.2点到点 PPP
PPP协议继承自HDLC(高级数据链路控制)协议，一种老但是使用广泛的协议。<br>
![fail](img/1.1.png)<br>



使用wireshark抓包时，定界符7E是看不到的在网卡处
被过滤，同样被过滤的还有FCS。<br>
![fail](img/1.2.png)
## 4.2广播信道的数据链路层
对于以太网的概念，有些是这样定义的：使用CSMA/CD带冲突检测的载波侦听多路访问技术通信是以太网(每个地址都有mac地址。)<br>
**我们要分清局域网和以太网的区别**
局域网是按地域大小划分的，比如一个家就可以使一个局域网。<br>

但是我们想一个问题，如果一个局域网的所有终端连接的都是交换机，根本没有用到集线器(意思是说，局域网中的计算机发出的非广播数据包，是不会传送到非目标主机上(被交换机阻塞))，那么就没有用到CSMA/CD协议，对于这种网络我们有时也习惯称为以太网。<br>



__2.冲突解决方法：退避算法__<br>
为了实现退避算法，以太网中有最短帧 512b也就是64个字节<br>
512b可以满足最大传输距离是5000m，而局域网实际不会达到这么远，所以512b足够<br>
__3.以太网帧没有结束字符编码因为使用的是曼彻斯特编码__<br>

<hr>

__网卡的作用__<br>
1.串行数据和并行数据转换<br>
2.数据链路层的功能，封装成帧，帧的差错检验和CSMA/CD<br>

__优化以太网__<br>

网桥，减小冲突域，但增加了延迟(不多见了，一般直接用交换机，交换机直接接电脑)<br>

__以太网的帧格式__<br>
![fail](img/1.3.png)<br>
![fail](img/1.4.png)<br>

# 数据链路层的上端ARP
ARP协议是为了将IP地址转换为MAC地址。在一个CSMA/CD以太网中通信要使用MAC地址，所以需要使用ARP协议找到目标主机的MAC地址。<br>
