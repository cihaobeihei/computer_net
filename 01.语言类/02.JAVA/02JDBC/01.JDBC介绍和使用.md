# JDBC介绍和使用

## 1.JDBC的简介
JDBC（Java Data Base Connectivity,java数据库连接）是一种用于执行SQL语句的Java API，可以为多种关系数据库提供统一访问，它由一组用Java语言编写的类和接口组成。是Java访问数据库的标准规范<br>
JDBC提供了一种基准,据此可以构建更高级的工具和接口，使数据库开发人员能够编写数据库应用程序。<br>
JDBC需要连接驱动，驱动是两个设备要进行通信，满足一定通信数据格式，数据格式由设备提供商规定，设备提供商为设备提供驱动软件，通过软件可以与该设备进行通信。<br>

## 2.JDBC的一般使用步骤
- 1.注册驱动
- 2.获得连接
- 3.获得语句执行平台
- 4.执行sql语句
- 5.处理结果
- 6.释放资源

### 1.导入jar包并关联源码
在实例演示中使用的是``mysql-connector-java-5.1.37-bin.jar``<br>
![fail](img/1.1.PNG)<br>

关联源码略<br>

## 3.JDBC重要类介绍
### 1.Driver类
Java通过定义接口来屏蔽不同数据库的底层细节，这些细节的实现由数据库厂商来做，这些实现类是Java操作数据库的桥梁，我们把它们称为“驱动”。<br>
Java定义了Driver类，任何数据库的厂商实现的驱动类都必须实现Driver接口。以MySQL为例，它的实现类叫做``com.mysql.jdbc.Driver``和接口的名字一样<br>

### 2.DriverManager类
DriverManager类是Java操纵数据库驱动Driver的一个工具类。<br>
其中重要的方法是注册驱动和通过驱动连接数据库。<br>

### 3.Connection类
Connection是数据库的连接对象，如果我们想要执行SQL语句，还必须通过Connection对象的createStatment方法创建一个Statment对象，再通过Statment对象执行SQL语句。<br>

### 4.Statement类
用来执行SQL语句。<br>

## 4.数据库的开发方式
数据库的开发方式分为3个步骤：<br>
- 1.从配置文件读取连接数据库的信息
- 2.连接数据库，并执行相应操作
- 3.将数据结构化处理

### 1.读取配置文件的信息
因为配置文件里的信息都是键值对所以我们使用``properties``类来读取，在配置文件中我们一般需要以下内容：<br>
- 1.数据库的类型(``MySQL``或``Oracle``)
- 2.数据库的名字及主机号
- 3.用户名密码等

以下是一个配置文件中的案例：<br>
```doc
driverClass=com.mysql.jdbc.Driver
url=jdbc:mysql://10.0.0.21:3306/noble
username=root
password=123456
```

#### 1.实例化Properties对象
```java
Properties prop = new Properties();
```

#### 2.给Properties对象加入流
```java
void Properties.load(InputStream inStream);
```
考虑以下事项：<br>
交给用户的程序是不包含源码的，所以对于要读取的数据是不能写``src/``路径的，一般对于配置文件我们在``bin/``路径下也有一份，并通过以下方式获得文件的输入流。<br>
```java
InputStream in = JDBCConect.class.getClassLoader().getResourceAsStream("database.properties");//JDBCConect是类名
```
对于上述代码的浅显解释：<br>
```java
JDBCConect.class                               //返回运行时的类
ClassLoader getClassLoader();                 //返回该类的类加载器
InputStream getResourceAsStream(String name); //返回读取指定资源的输入流
```
接下来我们把获得的输入流``in``加入到``Properties``对象中:<br>
```java
prop.load(in);
```
接下来我们的``Properties``对象就可以随时读取配置文件中的内容了。<br>
```java
String Properties.getProperty(String key);//用指定的键在此属性列表中搜索属性
```

### 2.连接数据库并执行查询操作
首先``Java``提供了一套标准接口用来操作数据库，不同的数据库厂商为了支持``java``语言会实现这些接口。<br>

#### 1.实例化数据库的Driver
为了能使用``JDBC``的方法，我们首先要实例化``Driver``类，此过程称为注册驱动。<br>
我们通过查看第三方源码会发现如下代码(在``Driver``类中)：<br>
```java
static {
        try {
            java.sql.DriverManager.registerDriver(new Driver());
        } catch (SQLException E) {
            throw new RuntimeException("Can't register driver!");
        }
    }
```
所以我们只要使用反射调用该类就可以实例化对象，不需要自己``new``一个对象。<br>
```java
Class.forName(prop.getProperty("driverClass"));
```

#### 2.连接数据库
我们使用DriverManager类的静态方法：<br>
```java
static Connection DriverManager.getConnection(String url, String user, String password);
```

```java
Connection con = DriverManager.getConnection(prop.getProperty("url"),
				prop.getProperty("username"),prop.getProperty("password"));
```

#### 3.执行相应操作
我们以执行查询操作为例。<br>
因为使用Statement类库有SQL注入风险，所以我们使用它的子类PreparedStatement<br>

Connection有prepareStatement方法：<br>
```java
PreparedStatement Connection.prepareStatement(String sql)
```

```java
PreparedStatement pst = con.prepareStatement("SELECT * FROM stu");
```

我们把查询结果存放到ResultSet中。<br>
```java
ResultSet rs = pst.executeQuery();
```

### 3.处理数据
到这一步我们一般要结构化存储该查询结果集，这里就不赘述了，简单介绍一下从ResultSet中抽取结果的方法。<br>

```java
while(rs.next()) {
			Sort s = new Sort(rs.getInt("id"),rs.getString("stu_id"),rs.getString("stu_name"),
					rs.getInt("age"),rs.getString("birthday"),rs.getString("gender"));
			list.add(s);
		}
```

### 4.整体代码如下
```java
package com.noble;

import java.io.InputStream;
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.util.ArrayList;
import java.util.List;
import java.util.Properties;

import com.domain.Sort;
import com.mysql.jdbc.Driver;

public class JDBCConect {
	public static void main(String[] args) throws Exception {
		InputStream in = JDBCConect.class.getClassLoader().getResourceAsStream("database.properties");
		Properties prop = new Properties();
		prop.load(in);

		Class.forName(prop.getProperty("driverClass"));

		Connection con = DriverManager.getConnection(prop.getProperty("url"),
				prop.getProperty("username"),prop.getProperty("password"));

		//Sort sort = new Sort();

		PreparedStatement pst = con.prepareStatement("SELECT * FROM stu");
		ResultSet rs = pst.executeQuery();

		List<Sort> list = new ArrayList<Sort>();
		while(rs.next()) {
			Sort s = new Sort(rs.getInt("id"),rs.getString("stu_id"),rs.getString("stu_name"),
					rs.getInt("age"),rs.getString("birthday"),rs.getString("gender"));
			list.add(s);
		}
		for(Sort s : list) {
			System.out.println(s);
		}
	}
}

```




### 3.查询语句的一般写法
数据表结构：<br>
```sql
mysql> desc stu;
+----------+---------------+------+-----+---------+-------+
| Field    | Type          | Null | Key | Default | Extra |
+----------+---------------+------+-----+---------+-------+
| id       | int(11)       | YES  |     | NULL    |       |
| stu_id   | varchar(20)   | YES  |     | NULL    |       |
| stu_name | varchar(20)   | YES  |     | NULL    |       |
| age      | int(11)       | YES  |     | NULL    |       |
| birthday | datetime      | YES  |     | NULL    |       |
| gender   | enum('M','F') | YES  |     | NULL    |       |
+----------+---------------+------+-----+---------+-------+
```

```java
package com.noble;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.Statement;

public class JDBCDemo02 {
	public static void main(String[] args) throws Exception {
		Class.forName("com.mysql.jdbc.Driver");

		String url = "jdbc:mysql://10.0.0.21:3306/noble";
		String username="root";
		String password="123456";
		Connection con = DriverManager.getConnection(url, username, password);
		Statement stat = con.createStatement();
		//到此为止 连接数据库的方法一致

		//使用接口ResultSet接受select查询结果
		String sql = "SELECT * FROM stu;";
		ResultSet rs = stat.executeQuery(sql);

		while(rs.next()) {//打印select结果，特别的对于enum类型数据可以使用getString获得其值
			System.out.println(rs.getInt("id")+"  "+rs.getString("stu_id")+"  "
					+rs.getString("stu_name")+"  "+rs.getInt("age")+"  "
					+rs.getDate("birthday")+"  "+rs.getString("gender"));
		}
		rs.close();
		stat.close();
		con.close();
	}
}

```


#### 2.PreparedStatement使用update更新

```java
package com.noble01;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;

public class JDBCDemo {
	public static void main(String[] args) throws Exception {
		Class.forName("com.mysql.jdbc.Driver");
		String url = "jdbc:mysql://10.0.0.21:3306/noble";
		String username = "root";
		String password = "123456";
		Connection con = DriverManager.getConnection(url, username, password);

		//同样的使用占位符？
		String sql = "UPDATE stu SET stu_id=?,stu_name=?,age=?,birthday=?,gender=? WHERE id=?";

		PreparedStatement pst = con.prepareStatement(sql);

		//替换占位符
		pst.setObject(1, 11111111);
		pst.setObject(2, "Jen");
		pst.setObject(3, 31);
		pst.setObject(4, "2018-10-31");
		pst.setObject(5, "M");
		pst.setObject(6, 3);

		//执行更新语句
		pst.executeUpdate();

		pst.close();
		con.close();
	}
}
```

#
