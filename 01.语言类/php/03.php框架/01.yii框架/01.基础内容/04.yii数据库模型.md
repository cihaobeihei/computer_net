# yii数据模型

## 1.数据模型创建

### 1.1.数据库实例
我们必修有自己的数据库,同时创建好初始表和数据.<br>

![fail](img/4.1.PNG)<br>

### 1.2.连接数据库
编辑``basic/config/db.php``文件<br>
```php
<?php
  
return [
    'class' => 'yii\db\Connection',
    'dsn' => 'mysql:host=127.0.0.1;dbname=world',//用127.0.0.1,不用localhost
    'username' => 'root',
    'password' => '123456',
    'charset' => 'utf8',

    // Schema cache options (for production environment)
    //'enableSchemaCache' => true,
    //'schemaCacheDuration' => 60,
    //'schemaCache' => 'cache',
];
```

### 1.3.创建数据库模型
我们在``basic/models``下创建数据库表对应的php类``City.php``:<br>
我们称这些类是操作数据库的活动模型.<br>
```php
<?php
namespase app\models;

use yii\db\ActiveRecord;

class City extends ActiveRecord(){

}
```

在完成上述操作后,就可以执行sql了.<br>

## 2.执行sql
### 2.1.查询数据
```php
<?php
namespace app\controllers;
use yii\web\Controller;
use app\models\City;

class HelloController extends Controller
{
    public function actionIndex(){
            $results = City::find()->where(['=','ID',129])->all();
            print_R($results);
    }
}
```
如果要是使用特殊查询需求如like,可以做如下操作:<br>
```php
$results = City::find()->where(['like','name','noble'])->all();//selec * from city where name like %noble%; %自动添加
```

### 2.2.关联查询


### 2.2.删除数据
```php
<?php
namespace app\controllers;
use yii\web\Controller;
use app\models\City;

class HelloController extends Controller
{
    public function actionIndex(){
            City::deleteAll('ID>:id',array[':id'=>129]);
    }
}
```

### 2.3.表单添加数据
```php
<?php
namespace app\controllers;
use yii\web\Controller;
use app\models\City;

class HelloController extends Controller
{
    public function actionIndex(){
            $city = new City;
            $city->ID = 10001;
            $city->Name = 'objk';
            $city->CountryCode = 23333;
            $city->District = 'hello world';
            $city->Population = 10000;
            $city->save();
    }
}
```

#### 数据验证
因为php是弱类型语言,所以需要进行数据验证,以免用户传入非法数据.<br>

我们之前在models下创建了一个ActiveRecord活动记录.<br>
在里面添加规则:<br>
```php
<?php
namespace app\models;
use yii\db\ActiveRecord;

class City extends ActiveRecord{
        public function rules(){
                return [
                        ['ID','integer'],                     //ID必修是Integer
                        ['Name','string'],                    //Name是String
                        ['CountryCode','string','length'=>3], //CountryCode必修是三个字符
                        ['District','string'],
                        ['Population','integer'],
                ];
        }
}
```
[更多的验证器规则参考](https://www.yiichina.com/doc/guide/2.0/tutorial-core-validators)<br>

接下来我们在sql操作的类中启用检查器:<br>
```php
<?php
namespace app\controllers;
use yii\web\Controller;
use app\models\City;

class HelloController extends Controller
{
    public function actionIndex(){
            $city = new City;
            $city->ID = 10001;
            $city->Name = 'objk';
            $city->CountryCode = 'abc';
            $city->District = 'hello world';
            $city->Population = 10000;
            if($city->hasErrors()){          //此处就是检查器
                return 'error';
            }
            $city->save();
    }
}
```

### 2.4.修改数据
```php
<?php
namespace app\controllers;
use yii\web\Controller;
use app\models\City;

class HelloController extends Controller
{
    public function actionIndex(){
            $results = City::find()->where(['=','ID',129])->one();
            $results->Name = 'noblewang';
            $results->save();
    }
}
```