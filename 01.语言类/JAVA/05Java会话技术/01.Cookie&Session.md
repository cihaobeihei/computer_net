# 会话技术

Http服务时无状态的，但有时我们需求服务器记住用户的信息，这时会引入会话技术，所谓会话就是在服务器和客户端之间保持一个链接，比如数据库连接，我们getConnection方法其实就是创建了一个会话。<br>

## 1.会话技术
**从打开一个浏览器访问某个站点，到关闭这个浏览器的整个过程，成为一次会话。**<br>
会话技术就是记录这次会话中客户端的状态与数据的。<br>
会话技术分为Cookie和Session：<br>
- Cookie:数据存储在客户端本地，减少服务器的存储压力，安全性不好，客户端可以清除Cookie
- Session：数据存储到服务器端，安全性相对好，增加服务器的压力

## 2.Cookie
Cookie机制有两方面：<br>
- 1.如何将Cookie写到客户浏览器
- 2.如何读取客户浏览器的Cookie

### 1.服务器向客户端写Cookie
#### 1.创建Cookie
```java
Cookie cookie = new Cookie(String cookieName, String cookieValue);
```

实例：<br>
```java
Cookie cookie = new Cookie("username", "noble");
response.addCookie(cookie);// 将Cookie发送到客户端
```

#### 2.设置Cookie在客户端的持久化时间
```java
cookie.setMaxAge(int seconds);
```
**注意：** 如果不设置持久化时间，cookie会存储在浏览器的内存中，浏览器关闭cookie信息便销毁，如果设置持久化时间，cookie信息会被持久化到浏览器的磁盘文件中<br>

实例：<br>
```java
cookie.setMaxAge(10*60);//设置Cookie信息在浏览器的磁盘文件中存储10分钟
```

#### 3.设置Cookie的携带路径
```java
cookie.setPath(String path);
```
**注意：** 如果不设置携带路径，那么该cookie信息在访问产生该cookie的web资源所在的路径都携带cookie信息。<br>

实例：<br>
```java
cookie.setPath("/WEB03");//代表访问WEB16应用中的任何资源都携带cookie
cookie.setPath("/WEB16/cookienoble");//代表访问WEB16中的cookienoble时才携带资源
```

#### 4.向客户端发送cookie
```java
response.addCookie(Cookie cookie);
```

#### 5.从浏览器上获得Cookie
```java
Cookie[] request.getCookies();
```
该方法返回浏览器上的所有Cookie，并返回一个Cookie对象数组，需要我们自己从中选取我们自己的Cookie。<br>

## 3.Session
Session技术是将数据存储在服务器端的技术，会为每一个客户创建一块内存空间存储客户的数据，但客户每次都要携带一个ID去服务器中寻找属于自己的内存空间。而该ID是通过Cookie实现的，所以说Session的实现是基于Cookie，Session需要借助于Cookie存储客户的唯一性表示JSESSIONID。<br>

### 1.有关Session的问题
对于session我们需要了解三个问题：<br>
- 1.怎样获得属于本客户端的session对象
- 2.怎样向session中存取数据(session也是一个域对象)
- 3.session的生命周期

### 2.获取Session对象
```java
HttpSession session = request.getSession();
```
此方法会获得专属于当前会话的Session对象，如果服务器端没有当前会话的Session对象，便创建该对象，如果有当前会话的session对象，便直接返回已有的该对象。<br>

### 3.怎样向session中存取数据(session也是一个域对象)
Session也是存储数据的区域对象，所以session对象也具有如下三个方法：<br>
```java
session.setAttribute(String name,Object obj);
seesion.getAttribute(String name);
session.removeAattribute(String name);
```

### 4.Session的生命周期
#### 1.创建
第一次执行``request.getSession()``时创建。<br>

#### 2.销毁
- 1.服务器(非正常)关闭时
- 2.session过期(默认30分钟)
  - 问题：时间的起算点 从何时开始计算30分钟？
  - 从不操作服务器的资源开始计时
- 3.手动销毁session
  - ``session.invalidate();``














#
