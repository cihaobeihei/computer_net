# DBUtils使用
只使用``JDBC``进行开发，我们会发现冗余代码过多，为了简化``JDBC``开发，我们可以采用``apache commons``组件的``DBUtils``。<br>
``DBUtils``就是``JDBC``的简化开发工具包。需要项目导入``commons-dbutils-1.6.jar``才可以使用。<br>

## 1.DBUtils三个重要类
- 1.``QueryRunner``: 提供对``SQL``语句操作的``API``
- 2.``ResultSetHandler``: 用于定义``select``操作后，如何封装结果集
- 3.``DBUtils``: 一个工具类，定义了关闭资源与事务处理的方法

### 1.使用QueryRunner执行插入、更新、删除


**QueryRunner类**<br>
我们通过QueryRunner类执行相应的sql语句，并处理返回集。<br>
```java
int	QueryRunner.update(Connection conn, String sql);
int	QueryRunner.update(Connection conn, String sql, Object... params);
int	QueryRunner.update(Connection conn, String sql, Object param);

<T> T	QueryRunner.query(Connection conn, String sql, ResultSetHandler<T> rsh);
<T> T	QueryRunner.query(Connection conn, String sql, ResultSetHandler<T> rsh, Object... params);
```

通过调用``QueryRunner``的``update``方法，可以执行插入、更新、删除。语法格式一致。<br>

```java
package com.noble;
import java.sql.Connection;
import java.sql.SQLException;
import org.apache.commons.dbutils.QueryRunner;
import org.junit.Test;
import com.jdbcutil.JDBCUtilsConnect;

public class QueryRunnerDemo {
	private static Connection con = JDBCUtilsConnect.getConnection();

	@Test
	public void insert() throws SQLException {
		QueryRunner qr = new QueryRunner();
		String sql = "INSERT INTO stu (id,stu_id,stu_name,age,birthday,gender) "
				+ "value(?,?,?,?,?,?)";
		Object[] params = {1,"1618012","merry",20,"1998-07-24","M"};
		int row = qr.update(con, sql, params);
		//return row;
	}
}
```
通过改变``sql``语句的不同来执行插入、更新、删除，但要注意?和参数位置和个数要对应。<br>

### 2.ResultSetHandler处理查询结果集

|结果集|详述|
|-----|----|
| ArrayHandler | 将结果集的第一条记录封装到一个Object[]数组中，数组的每一个元素就是这条记录中的每一个字段值 |
| ArrayListHandler  | 将结果集的每一条记录都封装到一个Object[]数组中，将这些数组封装到List集合中  |
| BeanHandler  | 将结果集中第一条记录封装到一个指定的javaBean中  |
| BeanListHandler  | 将结果集中每一条记录封装到指定的javaBean中，将这些javaBean再封装到List集合中  |
| ColumnListHandler  | 将结果集中指定的列的字段值，封装到一个List集合中  |
| MapHandler  | 将结果集中第一条记录封装到一个指定的Map中  |
| MapListHandler  | 将结果集中每一条记录封装到指定的Map中，并将这些Map封装到一个List集合中  |
| ScalarHandler  | 它用于单数据。例如select count(*) from 表操作  |

#### 1.ArrayHandler使用
每个结果集的使用方法都差不多``ArrayHandler``的使用方法如下：<br>

```java
@Test
public void arrayHandler() throws SQLException {
	QueryRunner qr = new QueryRunner();
	String sql = "SELECT * FROM country;";

	Object[] results = qr.query(con, sql, new ArrayHandler());
	for(Object obj : results) {
		System.out.print(obj+"\t");
	}
}
```


#### 2.ArrayListHandler使用

```java
public void arrayListHandler() throws SQLException {
		QueryRunner qr = new QueryRunner();
		String sql = "SELECT * FROM country;";

		List<Object[]> results = qr.query(con, sql, new ArrayListHandler());
		for(Object[] objs : results) {
			for(Object obj : objs) {
				System.out.print(obj+"\t");
			}
			System.out.println();
		}
	}
```

#### 3.BeanHandler使用
``BeanHandler``的构造器,我们传递``Bean.class``。<br>
```java
BeanHandler(Class<T> type);
```

在使用``BeanHandler``时要注意``Sort``要有成员``get``方法和无参构造。<br>

```java
public void BeanHandler() throws SQLException {
		QueryRunner qr = new QueryRunner();
		String sql = "SELECT * FROM country;";

		Sort s = qr.query(con, sql, new BeanHandler<Sort>(Sort.class));
		System.out.println(s);
	}
```

#### 4.BeanListHandler使用

``BeanListHandler``构造器的使用。<br>
```java
BeanListHandler(Class<T> type);
```

```java
public void BeanListHandler() throws SQLException {
		QueryRunner qr = new QueryRunner();
		String sql = "SELECT * FROM stu;";

		List<Sort> list = qr.query(con, sql, new BeanListHandler<Sort>(Sort.class));
		for(Sort s : list) {
			System.out.println(s);
		}
	}
```

#### 5.ColumnListHandler使用

``ColumnListHandler``构造器。<br>
```java
ColumnListHandler(String columnName);
```

```java
public void columnListHandler() throws SQLException {
		QueryRunner qr = new QueryRunner();
		String sql = "SELECT * FROM stu;";

		List<String> list = qr.query(con, sql, new ColumnListHandler<String>("stu_name"));
		for(String s : list) {
			System.out.println(s);
		}
	}
```

#### 6.ScalarHandler使用


```java
public void scalarHandler() throws SQLException {
		QueryRunner qr = new QueryRunner();
		String sql = "SELECT COUNT(*) FROM country";

		long num = qr.query(con, sql, new ScalarHandler<Long>());
		System.out.println(num);
	}
```

#### 7.MapHandler使用

```java
public void mapHandler() throws SQLException {
		QueryRunner qr = new QueryRunner();
		String sql = "SELECT * FROM country";

		Map<String,Object> map = qr.query(con, sql, new MapHandler());
		for(String key : map.keySet()) {
			System.out.println(key+">>:"+map.get(key));
		}
	}
```

#### 8.MapListHandler使用

```java
public void mapListHandler() throws SQLException {
		QueryRunner qr = new QueryRunner();
		String sql = "SELECT * FROM country";

		List<Map<String,Object>> list = qr.query(con, sql, new MapListHandler());

		for(Map<String,Object> map : list) {
			for(String key : map.keySet()) {
				System.out.println(key+">>:"+map.get(key));
			}
			System.out.println();
		}
	}
```

























#
