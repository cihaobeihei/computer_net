# API详解

## 1.Configuration类
Configuration类，主要目的是加载配置文件。<br>

### 1.构造器
一般是由无参构造就足够了。<br>
```java
Configuration conf = new Configuration();
```

### 2.加载配置文件的方法
我们使用``configure()``方法来加载配置文件。<br>

```java
Configuration Configuration.configure();
Configuration Configuration.configure(Document document);
Configuration Configuration.configure(File file);
Configuration Configuration.configure(String str);
Configuration Configuration.configure(URL url);
```

**主要两个事实**<br>
- 1.该方法我们使用的是configure方法的副作用，它会加载Hibernate的主配置文件。
- 2.我们一般使用的是无参configure方法，它默认加载src目录下的hibernate.cfg.xml文件。

### 3.Configuration的扩展方法
在过去，Hibernate使用的是properties加载配置文件。所以不能关ORM，我们需要单独告诉Configuration类数据库表的元数据和类的位置<br>
所以现在当我们在Hibernate的主配置文件中 关联了ORM(``<mapping resource="com/noble/Customer.hbm.xml"/>``)，就不需要执行后面介绍的方法了。<br>


```java
Configuration.addResource(resourceName);
Configuration.addClass(PersistentClass);
```

### 4.创建SessionFactory类
我们调研Configuration的buildSessionFactory方法，就可以得到对应的SessionFactory类。<br>
```java
SessionFactory buildSessionFactory();
```

## 2.SessionFactory对象
用于创建 操作数据库核心对象session对象 的工程。<br>
所以SessionFactory的功能就是创建Session对象。<br>
对于SessionFactory对象我们要注意两个事情：<br>
- 1.SessionFactory负责保存和使用所有配置信息，消耗内存非常大
- 2.SessionFactory属于线程安全的对象设计
基于以上两点，我们一般保证在web项目中，只创建一个SessionFactory对象。<br>


### 1.openSession()方法
我们使用openSession()方法打开一个Session。<br>
```java
Session openSession();
```

### 2.getCurrentSession()方法
获得一个与线程绑定的session对象。(之后详述)

## 3.Session对象
Session对象是对数据库表操作的核心类，包括增删改查和事务等。<br>

### 1.事务操作
```java
Transaction Session.getTransaction();   //获得一个事务
void Transaction.begin();               //打开事务
Transaction Session.beginTransaction(); //获得并开启一个事务(常用)
```

我们一般常用第二个方法，因为多做一步，可以省点事。<br>
关于事务的其他操作分别是事务提交和回滚：<br>
```java
void Transaction.commit();   //提交事务
void Transaction.rollback(); //回滚事务
```

### 2.增删改查
#### 1.增
我们的数据操作一般都在事务中：<br>

下面的实例不仅展现了插入操作的方法，也是对上述类的一般使用方法实践：<br>
```java
public void fun2(){
		//1 创建,调用空参构造
		Configuration conf = new Configuration().configure();
		//2 根据配置信息,创建 SessionFactory对象
		SessionFactory sf = conf.buildSessionFactory();
		//3 获得session
		Session session = sf.openSession();
		//4 session获得操作事务的Transaction对象
		//获得操作事务的tx对象
		//Transaction tx = session.getTransaction();
		//开启事务并获得操作事务的tx对象(建议使用)
		Transaction tx2 = session.beginTransaction();
		//----------------------------------------------
		Customer c = new Customer();
		c.setCust_name("公司名称");

		session.save(c);
		//----------------------------------------------
		tx2.commit();//提交事务
		session.close();//释放资源
		sf.close();//释放资源
	}
```
上面代码中Customer是我们自己创建的和数据库表的映射类。<br>

#### 2.查
我们需要变的仅仅是事务部分的代码：<br>
```java
//----------------------------------------------
		Customer customer = session.get(Customer.class, 1l);
		System.out.println(customer);
//----------------------------------------------
```
要注意一点的是上面的``get``方法是依据主键查询，而主键是``long``类型，所以在``1``的后面加了一个``l``,如果类型和``Class``的映射成员变量不匹配会报错。<br>

#### 3.改
```java
//----------------------------------------------
		Customer customer = session.get(Customer.class, 1l);
		customer.setCust_name("完美世界");
		session.update(customer);
//----------------------------------------------
```

#### 4.删
```java
//----------------------------------------------
		Customer customer = session.get(Customer.class, 1l);
		session.delete(customer);
//----------------------------------------------
```



















#
