# SQL语句
## 1.对表的操作
### 1.创建基本表
```sql
create table Studnet
  (Sno char(9) primary key,        /*Sno 是主码*/
   Sname char(20) unique,          /*取唯一值*/
   Ssex char(2),
   Sage smallint,
   Sdept char(20),
);
```

下面总结一下 数据结构的种类：<br>

|数据类型|含义|
|-------|----|
| char(n)   | 长度为n的字符串  |
| varchar(n)  | 最大长度为n的变长字符串  |
| int  | 长整型(4字节)  |
| smallint  | 短整型(2字节)  |
| bigint  | 大整型(8字节)  |
| float(n)  | 可选精度的浮点数，精度至少为n为数字  |
| boolean  | 布尔值  |
| date  | 日期(格式：YYYY-MM-DD)  |
| time  | 时间(格式：HH:MM:SS)  |
| timestamp  | 时间戳类型  |

### 2.修改基本表
修改的是关系的属性性质。<br>

给Student关系加入"入学时间"属性，并且是date类型：<br>
```sql
alter table Student add S_entrance date;
```

给Student表增加课程名Cname属性，因为设置(unique)，所以该属性中的值必须取唯一：<br>
```sql
alter table Student add unique(Cname);
```

删除Student表中的Cname属性：<br>
```sql
alter table Student drop Cname;
```

给Student表中的Sno属性重新设置字长：<br>
```sql
alter table Student alter column Sno char(10);
```

### 3.删除基本表
```sql
drop table Student CASCADE;
```

## 2.索引的操作
书中提到SQL标准没有规定索引的概念，但商业应用数据库都支持索引，索引的作用是加快数据的查询，对其原理没有详细的说明，后期试用时，在做补充。<br>
### 1.创建索引
```sql
create unique index Stusno on Student(Sno);
```

### 2.索引重命名
```sql
alter index Stusno rename to SCSno;
```

### 3.删除索引
```sql
drop index Stusno;
```

## 3.数据查询
### 1.单表查询
#### 1.查询表中指定列
```sql
select Sno,Sname from Student;
```

#### 2.Where语句

|查询条件|   谓词           |
| -----  | -----------     |
|比较   |=,>,<,>=,<=,!=,<>,!>,!<;NOT+上述比较运算符   |
|确定范围   | between and  ,  not between and  |
|确定集合   | in , not in  |
|字符匹配   | like , not like  |
|空值   | is NULL , is not NULL  |
|多重条件   | and , or , not  |

__比较大小__<br>
```sql
select Sname,Sage from Student where Sage<20;
```
__查询年龄在20~23之间__<br>
```sql
select Sname,Sdept,Sage
from Student
where Sage between 20 and 23;
```

__查询计算机科学系(CS)、数学系(MA)、信息系(IS)学生的姓名和性别__<br>
```sql
select Sname,Ssex
from Student
where Sdept in ('CS','MA','IS');
```
__查询不在计算机科学系(CS)、数学系(MA)、信息系(IS)学生的姓名和性别__<br>
```sql
select Sname,Ssex
from Student
where Sdept not in ('CS','MA','IS');
```

##### sql中的通配符
- 1.%类似*
- 2._类似.
- 3.\ 是转义字符


__查询所有以S开头学生姓名的学生__<br>
```sql
select Sname,Sno,Ssex
from Student
where Sname like 'S%'
```

__查询所有以S为第二个字母学生姓名的学生__<br>
```sql
select Sname,Sno,Ssex
from Student
where Sname like '_S%'
```

#### 3.order by语句
用户可以通过 order by 语句对查询结果做升序(ASC)或降序(DESC)排列，默认是升序。<br>

```sql
select Sno,Grade
from SC
where Cno='3'
order by Grade desc;
```

#### 4.聚集函数

|函数名  |  意义    |
| ------ | --------|
|COUNT(*)   | 统计对象的个数  |
|COUNT <属性>   | 统计该属性中对象的个数  |
|SUM <属性>   | 计算一列中值的总和 (此列必须是整形值)  |
|AVG <属性>   | 计算一列中的平均值 (此列必须是整形值)  |
|MAX <属性>   | 求一列中的最大值  |
|MIN <属性>   | 求一列中的最小值  |


__查询总人数__<br>
```sql
select COUNT(*)
from Student;
```

__计算选修1号课程的学生平均分__<br>
```sql
select AVG(Grade)
from SC
where Cno='1';
```

#### 5.group by函数
group by自句将查询结果按一列或多列的值分组，值相等的为一组<br>
语句规范如下：<br>
```sql
select <属性>,<聚集函数>
from <表名>
group by <第一列的属性>
```

__查询平均成绩大于等于90分的学生学号和平均成绩__<br>
```sql
select Sno,avg(Grade)
from SC
group by Sno
having avg(Grade)>90;
```
一般来说 having 关键字后面的聚集函数和第一行的聚集函数一致。<br>

### 2.连接查询

__查询选修2号课程且成绩在90分以上的所有学生的学号和姓名__<br>
```sql
select Student.Sno,Sname
from Student,SC
where Student.Sno=SC.Sno and SC.Cno='2' and SC.Grade>90;
```

### 3.嵌套查询
__查询与"Noble"在同一个系学习的学生__<br>
```sql
select Sno,Sname,Sdept
from Student
where Sdept in
  (select Sdept
   from Student
   where Sname='noble');
```

__找出每个学生超过他自己选修课程平局成绩的课程号__<br>
```sql
select Sno,Cno
from SC x
where Grade >= (select avg(Grade)
                from SC y
                where y.Sno=x.Sno);
```
命令中x是SC的别名。<br>

#### any all exists 谓词
__查询非计算机学科系中比计算机系任意一个学生年龄小的学生的姓名和年龄__<br>
```sql
select Sname,Sage
from Student
where Sage<any(select Sage
               from Student
               where Sdept='CS');
```
__注意：__ any all 前必须加比较符合(>,<,>=,<=,=,!=(或<>))<br>

exists 代表存在量词。<br>
__查询所有选修了1号课程的学生姓名__<br>
```sql
select Sname
from Student
where exists
     (select *
      from SC
      where Sno=Student.Sno and Cno='1');
```

## 4.数据更新

### 1.插入数据
__将一个新学生(学号：1618011，姓名：noble，性别：male，所在系：IS，年龄：21)__<br>
```sql
insert into Student(Sno,Sname,Ssex,Sdept,Sage)
values ('1618011','noble','male','IS',21);
```

### 2.修改数据
__将学生1618011的年龄更改为22岁__<br>
```sql
update Student
set Sage=22
where Sno='1618011';
```

__将计算机科学系全体学生的成绩置为0__<br>
```sql
update SC
set Grade=0
where Sno in
  (select Sno
  from Student
  where Sdept='CS');
```

### 3.删除数据

__删除学号为1618011的学生记录__<br>
```sql
delete
from Student
where Sno = '1618011';
```
