# 数据库的索引

## 1.问题
### 1.1.常见问题
- 1.为什么要使用索引(避免全局查找表,加快信息检索)
- 2.什么样的信息能够成为索引(主键,唯一键等,只要是能让数据做一定区分的字段)
- 3.索引的数据结构(主流是B+树,还有哈希结构,bitMap)
- 4.密集索引和稀疏索引的区别

### 1.2.衍生问题
- 1.如何定位并优化慢查询SQL
- 2.联合索引最左匹配原则的成因
- 3.索引是建立的越多越好吗

#### 1.2.1.如何定位并优化慢查询SQL
- 1.根据慢查询日志定位慢SQL
- 2.使用explain工具分析sql
- 3.修改sql或让sql尽量走索引

##### 1.2.1.1.根据慢查询日志定位慢SQL
在sql下执行:<br>
```sql
show variables like '%query%';
```
关注三个变量:<br>
```js
long_query_time 10.00000                // 超过10秒的sql被记录
slow_query_log  OFF                     // 慢查询日志关闭
slow_query_log_file /user/log/slow.log  // 慢查询日志的路径
```
判断是否有慢sql:<br>
```sql
show status like '%slow_queries%';
```
去slow_query_log_file指定的文件查看.<br>

##### 1.2.1.2.使用explain工具分析sql
在sql语句前添加``explain``工具即可.<br>
![fail](img/2.1.PNG)<br>

- 1.关注字段 type
    - ![fail](img/2.2.PNG)<br>
    - 1.观察上图type的类型越靠后效率越低
    - 2.如果是index或者是all表示全扫描,是需要优化的
- 2.关注字段 extra
    - ![fail](img/2.3.PNG)<br>
    
##### 1.2.1.3.修改sql或让sql尽量走索引
很多时候,修改sql语句不能满足业务需求,我们可以添加索引.<br>
如果我们要优化如下sql语句:<br>
```sql
select name from person_info_lage order by name desc;
```
添加索引:<br>
```sql
alter table person_info_lage add index idx_name(name);
```


## 2.常见索引
### 2.1.B-TREE
- 1.根节点至少包括两个节点
- 2.树中每个节点至少包含m个孩子(m>=2)
- 3.除了根节点和叶子节点,其他节点至少包含Ceil(m/2)个孩子
- 4.所有叶子节点都位于同一层

### 2.2.B+ TREE
- 1.非叶子节点的子树指针与关键字数相同
- 2.非叶子节点仅用来索引,值都保存在叶子节点中

### 2.3.HaSh索引
Hash索引可以在O(1) 的时间复杂度中查找数据,但也有明显的缺陷:<br>
- 1.仅能满足``=``和``IN``不能使用范围查询
- 2.不能利用Hash以外的索引做查找
- 3.不能避免表扫描(hash对撞)

### 2.4.BitMap索引
适用范围是:数据值的范围是固定的.<br>

### 2.5.密集索引,稀疏索引

![fail](img/2.4.PNG)<br>

InnoDB 密集索引.<br>
- 1.一个表只有一个密集索引
- 2.如果主键被定义,则主键是密集索引
- 3.如果没有定义主键,该表第一个唯一非空索引被视为密集索引
- 4.如果不满足上述条件,InnoDB会生成一个隐藏的密集索引
- 5.非主键索引存储相关键位和其对应的主键值,包含两次查找

稀疏索引.<br>
- 1.每个索引的查找过程都是一致的,没有区别
- 2.在MySQL中稀疏索引(索引和数据存在不同的文件中),密集索引(索引和数据都在一个文件中)